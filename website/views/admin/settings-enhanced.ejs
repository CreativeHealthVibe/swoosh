<!-- Enhanced SWOOSH Admin Settings Page -->
<div class="dashboard-container">
  <!-- Page Header -->
  <div class="welcome-section">
    <div class="card card-glow">
      <div class="card-header">
        <div class="welcome-text">
          <h1 class="gradient-text-blend">Bot Settings</h1>
          <p>Configure and customize your SWOOSH Bot experience</p>
        </div>
        
        <% if (messages.success) { %>
        <div class="alert alert-success alert-dismissible fade show" role="alert">
          <%= messages.success %>
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        <% } %>

        <% if (messages.error) { %>
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
          <%= messages.error %>
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        <% } %>
      </div>
    </div>
  </div>
  
  <!-- Settings Tabs -->
  <div class="settings-tabs">
    <ul class="nav nav-pills nav-fill" id="settingsTabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="general-tab" data-bs-toggle="tab" data-bs-target="#general" type="button" role="tab" aria-controls="general" aria-selected="true">
          <i class="fas fa-cog"></i> General
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="logging-tab" data-bs-toggle="tab" data-bs-target="#logging" type="button" role="tab" aria-controls="logging" aria-selected="false">
          <i class="fas fa-clipboard-list"></i> Logging
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="validation-tab" data-bs-toggle="tab" data-bs-target="#validation" type="button" role="tab" aria-controls="validation" aria-selected="false">
          <i class="fas fa-shield-alt"></i> Validation
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="admins-tab" data-bs-toggle="tab" data-bs-target="#admins" type="button" role="tab" aria-controls="admins" aria-selected="false">
          <i class="fas fa-users-cog"></i> Admins
        </button>
      </li>
    </ul>
    
    <div class="tab-content mt-4" id="settingsTabsContent">
      <!-- General Settings Tab -->
      <div class="tab-pane fade show active" id="general" role="tabpanel" aria-labelledby="general-tab">
        <div class="card">
          <div class="card-header">
            <h5 class="card-title"><i class="fas fa-sliders-h"></i> Bot Configuration</h5>
          </div>
          <div class="card-body">
            <form id="botSettingsForm" action="/admin/settings/update" method="POST">
              <div class="row g-4">
                <div class="col-md-6">
                  <div class="form-group">
                    <label for="prefix" class="form-label">
                      <i class="fas fa-terminal"></i> Command Prefix
                    </label>
                    <input type="text" class="form-control form-control-lg" id="prefix" name="prefix" value="<%= config.prefix %>" maxlength="3">
                    <div class="form-text">Character used before commands (e.g., <code><%= config.prefix %>help</code>)</div>
                  </div>
                </div>
                
                <div class="col-md-6">
                  <div class="form-group">
                    <label for="embedColor" class="form-label">
                      <i class="fas fa-palette"></i> Embed Color
                    </label>
                    <div class="d-flex align-items-center">
                      <input type="color" class="form-control form-control-color form-control-lg me-2" id="embedColor" name="embedColor" value="<%= config.embedColor %>">
                      <input type="text" class="form-control" id="embedColorHex" value="<%= config.embedColor %>" disabled>
                    </div>
                    <div class="form-text">Color used for message embeds</div>
                  </div>
                </div>
                
                <div class="col-md-12">
                  <div class="form-group">
                    <label for="ticketCategory" class="form-label">
                      <i class="fas fa-ticket-alt"></i> Ticket Category
                    </label>
                    <input type="text" class="form-control" id="ticketCategory" name="ticketCategory" value="<%= config.ticketCategory %>">
                    <div class="form-text">Discord category for new tickets</div>
                  </div>
                </div>
                
                <div class="col-md-12">
                  <div class="form-group">
                    <label for="logChannelId" class="form-label">
                      <i class="fas fa-clipboard-list"></i> Main Log Channel ID
                    </label>
                    <input type="text" class="form-control" id="logChannelId" name="logChannelId" value="<%= config.logChannelId %>" placeholder="Discord Channel ID">
                    <div class="form-text">Main channel for sending log messages</div>
                  </div>
                </div>
              </div>
            
              <!-- Hidden fields for other settings -->
              <input type="hidden" id="deletedMessages" name="deletedMessages" value="<%= config.loggingChannels.deletedMessages %>">
              <input type="hidden" id="ticketTranscripts" name="ticketTranscripts" value="<%= config.loggingChannels.ticketTranscripts %>">
              <input type="hidden" id="commandUsage" name="commandUsage" value="<%= config.loggingChannels.commandUsage %>">
              <input type="hidden" id="botStatus" name="botStatus" value="<%= config.loggingChannels.botStatus %>">
              <input type="hidden" id="bountyMin" name="bountyMin" value="<%= config.validation.bountyMin %>">
              <input type="hidden" id="bountyMax" name="bountyMax" value="<%= config.validation.bountyMax %>">
              
              <div class="mt-4">
                <button type="submit" class="btn btn-primary btn-lg">
                  <i class="fas fa-save me-2"></i> Save All Settings
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
      
      <!-- Logging Settings Tab -->
      <div class="tab-pane fade" id="logging" role="tabpanel" aria-labelledby="logging-tab">
        <div class="card">
          <div class="card-header">
            <h5 class="card-title"><i class="fas fa-clipboard-list"></i> Logging Channels</h5>
          </div>
          <div class="card-body">
            <form id="loggingSettingsForm" onsubmit="return updateMainForm()">
              <div class="row g-4">
                <div class="col-md-6">
                  <div class="form-group">
                    <label for="deletedMessagesInput" class="form-label">
                      <i class="fas fa-trash-alt"></i> Deleted Messages
                    </label>
                    <input type="text" class="form-control" id="deletedMessagesInput" value="<%= config.loggingChannels.deletedMessages %>" placeholder="Channel ID">
                    <div class="form-text">Channel for logging deleted messages</div>
                  </div>
                </div>
                
                <div class="col-md-6">
                  <div class="form-group">
                    <label for="ticketTranscriptsInput" class="form-label">
                      <i class="fas fa-scroll"></i> Ticket Transcripts
                    </label>
                    <input type="text" class="form-control" id="ticketTranscriptsInput" value="<%= config.loggingChannels.ticketTranscripts %>" placeholder="Channel ID">
                    <div class="form-text">Channel for storing ticket transcripts</div>
                  </div>
                </div>
                
                <div class="col-md-6">
                  <div class="form-group">
                    <label for="commandUsageInput" class="form-label">
                      <i class="fas fa-terminal"></i> Command Usage
                    </label>
                    <input type="text" class="form-control" id="commandUsageInput" value="<%= config.loggingChannels.commandUsage %>" placeholder="Channel ID">
                    <div class="form-text">Channel for logging command usage</div>
                  </div>
                </div>
                
                <div class="col-md-6">
                  <div class="form-group">
                    <label for="botStatusInput" class="form-label">
                      <i class="fas fa-info-circle"></i> Bot Status
                    </label>
                    <input type="text" class="form-control" id="botStatusInput" value="<%= config.loggingChannels.botStatus %>" placeholder="Channel ID">
                    <div class="form-text">Channel for bot status updates</div>
                  </div>
                </div>
              </div>
              
              <div class="mt-4">
                <button type="submit" class="btn btn-primary">
                  <i class="fas fa-sync-alt me-2"></i> Apply Logging Settings
                </button>
              </div>
            </form>
            
            <div class="mt-5">
              <h6><i class="fas fa-info-circle"></i> Logging System Info</h6>
              <div class="logging-info">
                <div class="info-item">
                  <div class="info-label">Log Database</div>
                  <div class="info-value">Discord Channel Storage</div>
                </div>
                <div class="info-item">
                  <div class="info-label">Log Retention</div>
                  <div class="info-value">14 days</div>
                </div>
                <div class="info-item">
                  <div class="info-label">Transcript Format</div>
                  <div class="info-value">HTML / Raw Text</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Validation Settings Tab -->
      <div class="tab-pane fade" id="validation" role="tabpanel" aria-labelledby="validation-tab">
        <div class="card">
          <div class="card-header">
            <h5 class="card-title"><i class="fas fa-shield-alt"></i> Validation Settings</h5>
          </div>
          <div class="card-body">
            <form id="validationSettingsForm" onsubmit="return updateMainForm()">
              <div class="row g-4">
                <div class="col-md-6">
                  <div class="form-group">
                    <label for="bountyMinInput" class="form-label">
                      <i class="fas fa-coins"></i> Minimum Bounty
                    </label>
                    <input type="number" class="form-control" id="bountyMinInput" value="<%= config.validation.bountyMin %>" min="1">
                    <div class="form-text">Minimum allowed bounty amount</div>
                  </div>
                </div>
                
                <div class="col-md-6">
                  <div class="form-group">
                    <label for="bountyMaxInput" class="form-label">
                      <i class="fas fa-coins"></i> Maximum Bounty
                    </label>
                    <input type="number" class="form-control" id="bountyMaxInput" value="<%= config.validation.bountyMax %>" min="100">
                    <div class="form-text">Maximum allowed bounty amount</div>
                  </div>
                </div>
              </div>
              
              <div class="mt-4">
                <button type="submit" class="btn btn-primary">
                  <i class="fas fa-sync-alt me-2"></i> Apply Validation Settings
                </button>
              </div>
            </form>
            
            <div class="mt-5">
              <h6><i class="fas fa-info-circle"></i> Allowed Image Types</h6>
              <div class="image-types">
                <% config.validation.allowedImageTypes.forEach(type => { %>
                <span class="image-type-badge"><%= type %></span>
                <% }); %>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Admin Settings Tab -->
      <div class="tab-pane fade" id="admins" role="tabpanel" aria-labelledby="admins-tab">
        <div class="card">
          <div class="card-header">
            <h5 class="card-title"><i class="fas fa-users-cog"></i> Admin Users</h5>
          </div>
          <div class="card-body">
            <div class="admin-list">
              <% for (const userId of config.adminUserIds) { %>
              <div class="admin-item">
                <div class="admin-info">
                  <div class="admin-id"><%= userId %></div>
                  <div class="admin-role">Full Administrator</div>
                </div>
                <form action="/admin/users/remove" method="POST" class="d-inline">
                  <input type="hidden" name="userId" value="<%= userId %>">
                  <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to remove this admin user?')">
                    <i class="fas fa-times"></i> Remove
                  </button>
                </form>
              </div>
              <% } %>
            </div>
            
            <div class="admin-add-section">
              <h6 class="mt-4 mb-3"><i class="fas fa-plus-circle"></i> Add New Admin</h6>
              <form action="/admin/users/add" method="POST">
                <div class="row g-3">
                  <div class="col-md-5">
                    <div class="form-group">
                      <label for="userId" class="form-label">Discord User ID</label>
                      <input type="text" class="form-control" id="userId" name="userId" placeholder="Enter Discord ID" required pattern="^\d{17,19}$">
                    </div>
                  </div>
                  <div class="col-md-5">
                    <div class="form-group">
                      <label for="comment" class="form-label">User Description</label>
                      <input type="text" class="form-control" id="comment" name="comment" placeholder="e.g. Moderator, Developer" required>
                    </div>
                  </div>
                  <div class="col-md-2">
                    <div class="form-group mt-4">
                      <button type="submit" class="btn btn-primary w-100">
                        <i class="fas fa-plus-circle"></i> Add
                      </button>
                    </div>
                  </div>
                </div>
              </form>
            </div>
            
            <div class="special-admin-section mt-5">
              <div class="card special-card">
                <div class="card-body">
                  <h6><i class="fas fa-star"></i> Special Admin Functions</h6>
                  <p class="text-muted">Manage special administration accounts and access controls</p>
                  <a href="/admin/users" class="btn btn-outline-primary">
                    <i class="fas fa-user-plus"></i> Manage Local Admins
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  /* Settings Specific Styles */
  .settings-tabs .nav-pills {
    background: var(--background-light);
    border-radius: var(--border-radius);
    padding: 0.5rem;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }
  
  .settings-tabs .nav-link {
    color: var(--text-secondary);
    border-radius: var(--border-radius);
    padding: 0.75rem 1.5rem;
    transition: all 0.3s ease;
    margin: 0 0.25rem;
  }
  
  .settings-tabs .nav-link:hover {
    background: rgba(255, 255, 255, 0.05);
    color: var(--text-primary);
  }
  
  .settings-tabs .nav-link.active {
    background: var(--gradient-primary);
    color: white;
    box-shadow: 0 4px 10px rgba(156, 77, 255, 0.3);
  }
  
  .settings-tabs .nav-link i {
    margin-right: 0.5rem;
  }
  
  .form-group {
    margin-bottom: 1.5rem;
  }
  
  .form-label {
    margin-bottom: 0.5rem;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  
  .form-label i {
    color: var(--primary-color);
  }
  
  /* Admin list styles */
  .admin-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin-bottom: 2rem;
  }
  
  .admin-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: var(--background-light);
    border-radius: var(--border-radius);
    padding: 1rem;
    border-left: 4px solid var(--primary-color);
    transition: all 0.3s ease;
  }
  
  .admin-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  }
  
  .admin-info {
    display: flex;
    flex-direction: column;
  }
  
  .admin-id {
    font-family: monospace;
    font-weight: 600;
    color: var(--text-primary);
  }
  
  .admin-role {
    font-size: 0.85rem;
    color: var(--primary-color);
  }
  
  .admin-add-section {
    background: var(--background-light);
    border-radius: var(--border-radius);
    padding: 1.5rem;
    margin-top: 2rem;
  }
  
  .special-card {
    background: linear-gradient(45deg, rgba(156, 77, 255, 0.1), rgba(0, 229, 255, 0.1));
    border-left: 4px solid var(--accent-color);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
  }
  
  /* Logging info styles */
  .logging-info {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 1rem;
    margin-top: 1rem;
  }
  
  .info-item {
    background: var(--background-light);
    padding: 1rem;
    border-radius: var(--border-radius);
  }
  
  .info-label {
    font-size: 0.85rem;
    color: var(--text-secondary);
    margin-bottom: 0.5rem;
  }
  
  .info-value {
    font-weight: 600;
    color: var(--text-primary);
  }
  
  /* Image types badges */
  .image-types {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-top: 1rem;
  }
  
  .image-type-badge {
    background: var(--background-light);
    color: var(--text-primary);
    padding: 0.4rem 0.8rem;
    border-radius: 2rem;
    font-size: 0.85rem;
    font-family: monospace;
    border: 1px solid rgba(156, 77, 255, 0.3);
  }
  
  /* Responsive styles */
  @media (max-width: 992px) {
    .settings-tabs .nav-pills {
      flex-wrap: wrap;
    }
    
    .settings-tabs .nav-link {
      margin-bottom: 0.5rem;
    }
  }
  
  @media (max-width: 768px) {
    .admin-item {
      flex-direction: column;
      align-items: flex-start;
      gap: 1rem;
    }
    
    .admin-item form {
      align-self: flex-end;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Update color text when color picker changes
    document.getElementById('embedColor').addEventListener('input', function() {
      document.getElementById('embedColorHex').value = this.value;
    });
    
    // Tab persistence through URL parameters
    const params = new URLSearchParams(window.location.search);
    const tabParam = params.get('tab');
    
    if (tabParam) {
      const tab = document.getElementById(tabParam + '-tab');
      if (tab) {
        tab.click();
      }
    }
    
    // Make tabs update URL
    const tabs = document.querySelectorAll('[data-bs-toggle="tab"]');
    tabs.forEach(tab => {
      tab.addEventListener('shown.bs.tab', function(e) {
        const id = e.target.id.replace('-tab', '');
        const newUrl = new URL(window.location);
        newUrl.searchParams.set('tab', id);
        history.replaceState({}, '', newUrl);
      });
    });
    
    // Min/max validation
    document.getElementById('bountyMinInput').addEventListener('change', function() {
      const min = parseInt(this.value);
      const max = parseInt(document.getElementById('bountyMaxInput').value);
      
      if (min >= max) {
        alert('Minimum bounty must be less than maximum bounty');
        this.value = <%= config.validation.bountyMin %>;
      }
    });
    
    document.getElementById('bountyMaxInput').addEventListener('change', function() {
      const max = parseInt(this.value);
      const min = parseInt(document.getElementById('bountyMinInput').value);
      
      if (max <= min) {
        alert('Maximum bounty must be greater than minimum bounty');
        this.value = <%= config.validation.bountyMax %>;
      }
    });
    
    // Validation and logging forms submit handler
    window.updateMainForm = function() {
      document.getElementById('deletedMessages').value = document.getElementById('deletedMessagesInput').value;
      document.getElementById('ticketTranscripts').value = document.getElementById('ticketTranscriptsInput').value;
      document.getElementById('commandUsage').value = document.getElementById('commandUsageInput').value;
      document.getElementById('botStatus').value = document.getElementById('botStatusInput').value;
      document.getElementById('bountyMin').value = document.getElementById('bountyMinInput').value;
      document.getElementById('bountyMax').value = document.getElementById('bountyMaxInput').value;
      
      document.getElementById('botSettingsForm').submit();
      return false;
    };
    
    // Form submission confirmation
    document.getElementById('botSettingsForm').addEventListener('submit', function(e) {
      if (!confirm('Are you sure you want to update the bot configuration? This will restart the bot.')) {
        e.preventDefault();
      }
    });
  });
</script>
