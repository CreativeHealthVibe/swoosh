<div class="main-content-container">
  <!-- Page Header -->
  <div class="content-header">
    <h1 class="content-title">
      <i class="fas fa-sliders-h icon-gradient"></i>
      Bounty System & News
    </h1>
    <p class="content-subtitle">Send bounties directly and manage news announcements</p>
  </div>

  <!-- Flash Messages -->
  <% if (typeof messages !== 'undefined' && messages.success) { %>
    <div class="alert alert-success">
      <i class="fas fa-check-circle me-2"></i> <%= messages.success %>
    </div>
  <% } %>
  
  <% if (typeof messages !== 'undefined' && messages.error) { %>
    <div class="alert alert-danger">
      <i class="fas fa-exclamation-circle me-2"></i> <%= messages.error %>
    </div>
  <% } %>

  <!-- Main Content -->
  <div class="content-section">
    <div class="admin-tabs">
      <button class="tab-btn active" data-tab="bounty">
        <i class="fas fa-money-bill-wave"></i>
        Send Bounty
      </button>
      <button class="tab-btn" data-tab="news">
        <i class="fas fa-newspaper"></i>
        News Updates
      </button>
    </div>

    <!-- Bounty Tab Content -->
    <div class="tab-content active" id="bounty-tab">
      <div class="row">
        <div class="col-lg-7">
          <div class="admin-card">
            <div class="admin-card-header">
              <h3><i class="fas fa-crosshairs"></i> Send Bounty Target</h3>
            </div>
            <div class="admin-card-content">
              <form action="/admin/customization/send-bounty" method="POST">
                <div class="mb-4">
                  <label for="bountyColor" class="form-label">Embed Color</label>
                  <div class="input-group">
                    <input type="color" class="form-control form-control-color" id="bountyColor" name="bountyColor" value="#9B59B6">
                    <input type="text" class="form-control" id="bountyColorText" value="#9B59B6">
                  </div>
                </div>

                <div class="mb-4">
                  <label for="targetUser" class="form-label">Target Username</label>
                  <input type="text" class="form-control" id="targetUser" name="targetUser" placeholder="Enter target username" required>
                </div>
                
                <div class="mb-4">
                  <label for="robloxId" class="form-label">Roblox ID</label>
                  <input type="text" class="form-control" id="robloxId" name="robloxId" placeholder="Enter Roblox ID" required>
                </div>
                
                <div class="mb-4">
                  <label for="bountyAmount" class="form-label">Bounty Amount</label>
                  <div class="input-group">
                    <span class="input-group-text">R$</span>
                    <input type="number" class="form-control" id="bountyAmount" name="bountyAmount" placeholder="Enter amount" min="15" max="30000" required>
                  </div>
                  <small class="form-text text-muted">Amount must be between R$15 and R$30,000</small>
                </div>

                <div class="mb-4">
                  <label for="bountyReason" class="form-label">Reason (Optional)</label>
                  <textarea class="form-control" id="bountyReason" name="bountyReason" rows="2" placeholder="Enter reason for the bounty"></textarea>
                </div>
                
                <div class="mb-4">
                  <label for="clipRequired" class="form-label">Clip Required</label>
                  <select class="form-select" id="clipRequired" name="clipRequired">
                    <option value="true" selected>Yes</option>
                    <option value="false">No</option>
                  </select>
                </div>
                
                <div class="mb-4">
                  <label for="bountyChannel" class="form-label">Target Channel</label>
                  <select class="form-select" id="bountyChannel" name="bountyChannel">
                    <option value="" selected>Use Default Channel (from Config)</option>
                    <% if (typeof client !== 'undefined' && client) { %>
                      <% client.guilds.cache.forEach(guild => { %>
                        <optgroup label="<%= guild.name %>">
                          <% guild.channels.cache
                              .filter(c => {
                                // Only include text channels
                                return c.type !== 2 && // Not voice
                                       c.type !== 4 && // Not category
                                       c.type !== 13 && // Not stage
                                       c.isTextBased !== false; // Is text based if property exists
                              })
                              .forEach(channel => { %>
                            <option value="<%= channel.id %>"><%= channel.name %></option>
                          <% }); %>
                        </optgroup>
                      <% }); %>
                    <% } %>
                  </select>
                  <small class="form-text text-muted">Select channel where bounty will be posted</small>
                </div>
                
                <hr class="my-4">
                <h5 class="mb-3">Appearance Settings</h5>
              
                <div class="mb-4">
                  <label for="bountyName" class="form-label">Webhook Name</label>
                  <input type="text" class="form-control" id="bountyName" name="bountyName" value="SWOOSH Bounty System">
                </div>

                <div class="mb-4">
                  <label for="bountyAvatarUrl" class="form-label">Avatar URL</label>
                  <input type="text" class="form-control" id="bountyAvatarUrl" name="bountyAvatarUrl" value="https://i.imgur.com/YzOA3Rb.png">
                </div>

                <div class="mb-4">
                  <label for="defaultThumbnailUrl" class="form-label">Default Thumbnail</label>
                  <input type="text" class="form-control" id="defaultThumbnailUrl" name="defaultThumbnailUrl" value="https://i.imgur.com/YzOA3Rb.png">
                </div>

                <button type="submit" class="btn btn-primary">
                  <i class="fas fa-paper-plane me-2"></i> Send Bounty
                </button>
              </form>
            </div>
          </div>
        </div>

        <div class="col-lg-5">
          <div class="admin-card">
            <div class="admin-card-header">
              <h3><i class="fas fa-eye"></i> Live Preview</h3>
            </div>
            <div class="admin-card-content">
              <div class="discord-preview">
                <div class="discord-message-header">
                  <img id="preview-avatar" src="https://i.imgur.com/YzOA3Rb.png" class="discord-avatar">
                  <span id="preview-name" class="discord-username">SWOOSH Bounty System</span>
                </div>
                <div id="discord-embed" class="discord-embed">
                  <div class="discord-embed-title">:S__dollars: SWOOSH BOUNTY: <span id="preview-target-upper">EXAMPLE_USER</span> :S__dollars:</div>
                  <div class="discord-embed-description">A new bounty has been placed! Eliminate the target to claim the reward.</div>
                  <div class="discord-embed-fields">
                    <div class="discord-embed-field">üë§ Target<br><span id="preview-target">ExampleUser</span></div>
                    <div class="discord-embed-field">:S__ID: Roblox ID<br><span id="preview-roblox-id">55</span></div>
                    <div class="discord-embed-field">üíµ Reward<br><span id="preview-amount">R$1,000</span></div>
                    <div class="discord-embed-field">:S__Clip: Clip Required<br><span id="preview-clip-required">‚úÖ Yes</span></div>
                    <div class="discord-embed-field">:S__Crown: Hosted By<br>@<span id="preview-host">admin</span></div>
                    <div class="discord-embed-field">:S__Time: Posted<br>Just now</div>
                  </div>
                  <div class="discord-embed-footer">
                    <img id="preview-thumbnail" src="https://i.imgur.com/YzOA3Rb.png" class="discord-footer-icon">
                    <span class="discord-footer-text">To claim this bounty, open a ticket and provide evidence.</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- News Tab Content -->
    <div class="tab-content" id="news-tab">
      <div class="row">
        <div class="col-lg-7">
          <div class="admin-card">
            <div class="admin-card-header">
              <h3><i class="fas fa-bullhorn"></i> Send News Update</h3>
            </div>
            <div class="admin-card-content">
              <form id="newsForm" action="/admin/customization/send-news" method="POST">
                <div class="mb-4">
                  <label for="newsTitle" class="form-label">Announcement Title</label>
                  <input type="text" class="form-control" id="newsTitle" name="newsTitle" required placeholder="Enter announcement title">
                </div>
                
                <div class="mb-4">
                  <label for="newsContent" class="form-label">Announcement Content</label>
                  <textarea class="form-control" id="newsContent" name="newsContent" rows="5" required placeholder="Enter detailed announcement message..."></textarea>
                </div>
                
                <div class="row mb-4">
                  <div class="col-md-6">
                    <label for="newsColor" class="form-label">Embed Color</label>
                    <input type="color" class="form-control" id="newsColor" name="newsColor" value="#5865F2">
                  </div>
                  <div class="col-md-6">
                    <label for="newsImage" class="form-label">Image URL (Optional)</label>
                    <input type="url" class="form-control" id="newsImage" name="newsImage" placeholder="https://example.com/image.png">
                  </div>
                </div>
                
                <div class="d-flex justify-content-between align-items-center">
                  <div class="text-muted">
                    <i class="fas fa-info-circle me-1"></i> News will be sent to all configured servers
                  </div>
                  <button type="submit" class="btn btn-primary">
                    <i class="fas fa-paper-plane me-2"></i> Send News
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
        
        <div class="col-lg-5">
          <div class="admin-card">
            <div class="admin-card-header">
              <h3><i class="fas fa-eye"></i> News Preview</h3>
            </div>
            <div class="admin-card-content">
              <div class="discord-preview">
                <div class="discord-message-header">
                  <img src="https://i.imgur.com/YzOA3Rb.png" class="discord-avatar">
                  <span class="discord-username">SWOOSH Bot</span>
                </div>
                <div id="news-discord-embed" class="discord-embed">
                  <div id="newsTitlePreview" class="discord-embed-title">Announcement Title</div>
                  <div id="newsContentPreview" class="discord-embed-description">News content will appear here...</div>
                  <div id="newsImagePreviewContainer" style="display: none;">
                    <img id="newsImagePreview" src="" class="discord-embed-image">
                  </div>
                  <div class="discord-embed-footer">
                    <span class="discord-footer-text">SWOOSH Bot ‚Ä¢ Just now</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Page-specific styles -->
<style>
  /* Tab Content Styling */
  .tab-content {
    display: none;
  }
  
  .tab-content.active {
    display: block;
  }
  
  /* Discord UI Styling */
  .discord-preview {
    background-color: #36393f;
    border-radius: 8px;
    padding: 20px;
    color: #dcddde;
    font-family: 'Whitney', 'Helvetica Neue', Helvetica, Arial, sans-serif;
  }
  
  .discord-message-header {
    display: flex;
    align-items: center;
    margin-bottom: 15px;
  }
  
  .discord-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    margin-right: 10px;
  }
  
  .discord-username {
    font-weight: 500;
    color: white;
  }
  
  .discord-embed {
    margin-top: 5px;
    border-left: 4px solid #9B59B6;
    padding-left: 12px;
  }
  
  #news-discord-embed {
    border-left: 4px solid #5865F2;
  }
  
  .discord-embed-title {
    font-weight: bold;
    font-size: 16px;
    color: white;
    margin-bottom: 5px;
  }
  
  .discord-embed-description {
    margin-bottom: 10px;
    font-size: 14px;
  }
  
  .discord-embed-fields {
    margin-bottom: 10px;
    font-size: 14px;
  }
  
  .discord-embed-field {
    margin-top: 5px;
  }
  
  .discord-embed-image {
    max-width: 100%;
    max-height: 300px;
    border-radius: 3px;
    margin-top: 10px;
    margin-bottom: 10px;
  }
  
  .discord-embed-footer {
    display: flex;
    align-items: center;
    font-size: 12px;
    color: #72767d;
    margin-top: 10px;
  }
  
  .discord-footer-icon {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    margin-right: 8px;
  }
</style>

<!-- Page-specific script -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Tab switching - Fixed implementation
    const bountyTabBtn = document.querySelector('[data-tab="bounty"]');
    const newsTabBtn = document.querySelector('[data-tab="news"]');
    const bountyTabContent = document.getElementById('bounty-tab');
    const newsTabContent = document.getElementById('news-tab');
    
    // Debug elements
    console.log("Bounty tab button:", bountyTabBtn);
    console.log("News tab button:", newsTabBtn);
    console.log("Bounty content:", bountyTabContent);
    console.log("News content:", newsTabContent);
    
    // Set click handlers
    if (bountyTabBtn) {
      bountyTabBtn.addEventListener('click', function() {
        console.log("Bounty tab clicked");
        // Update active buttons
        bountyTabBtn.classList.add('active');
        newsTabBtn.classList.remove('active');
        
        // Update visible content
        bountyTabContent.classList.add('active');
        newsTabContent.classList.remove('active');
      });
    }
    
    if (newsTabBtn) {
      newsTabBtn.addEventListener('click', function() {
        console.log("News tab clicked");
        // Update active buttons
        newsTabBtn.classList.add('active');
        bountyTabBtn.classList.remove('active');
        
        // Update visible content
        newsTabContent.classList.add('active');
        bountyTabContent.classList.remove('active');
      });
    }
    
    // Bounty Preview Updates
    function updateBountyPreview() {
      // Get basic appearance settings
      const color = document.getElementById('bountyColor').value || '#9B59B6';
      const name = document.getElementById('bountyName').value || 'SWOOSH Bounty System';
      const avatarUrl = document.getElementById('bountyAvatarUrl').value || 'https://i.imgur.com/YzOA3Rb.png';
      const thumbnailUrl = document.getElementById('defaultThumbnailUrl').value || 'https://i.imgur.com/YzOA3Rb.png';
      
      // Get target settings
      const targetUser = document.getElementById('targetUser').value || 'EXAMPLE_USER';
      const robloxId = document.getElementById('robloxId').value || '55';
      const amount = document.getElementById('bountyAmount').value || '1,000';
      const reason = document.getElementById('bountyReason').value || '';
      const clipRequired = document.getElementById('clipRequired').value === 'true' ? '‚úÖ Yes' : '‚ùå No';
      
      // Update the preview
      document.getElementById('discord-embed').style.borderLeftColor = color;
      document.getElementById('preview-name').innerText = name;
      document.getElementById('preview-avatar').src = avatarUrl;
      document.getElementById('preview-thumbnail').src = thumbnailUrl;
      
      // Update title and target
      document.getElementById('preview-target-upper').innerText = targetUser.toUpperCase();
      document.getElementById('preview-target').innerText = targetUser;
      document.getElementById('preview-roblox-id').innerText = robloxId;
      document.getElementById('preview-amount').innerText = `R$${amount}`;
      document.getElementById('preview-clip-required').innerText = clipRequired;
      document.getElementById('preview-host').innerText = '<%= user.username || "admin" %>';
      
      // Add reason if provided
      const description = document.querySelector('.discord-embed-description');
      if (description) {
        if (reason) {
          description.innerHTML = `A new bounty has been placed! Eliminate the target to claim the reward.<br><br>Reason: ${reason}`;
        } else {
          description.innerHTML = 'A new bounty has been placed! Eliminate the target to claim the reward.';
        }
      }
    }
    
    // Color picker sync
    const colorPicker = document.getElementById('bountyColor');
    const colorText = document.getElementById('bountyColorText');
    
    if (colorPicker && colorText) {
      colorPicker.addEventListener('input', function() {
        colorText.value = colorPicker.value;
        updateBountyPreview();
      });
      
      colorText.addEventListener('input', function() {
        if (colorText.value.match(/^#[0-9A-F]{6}$/i)) {
          colorPicker.value = colorText.value;
          updateBountyPreview();
        }
      });
    }
    
    // Setup other input events for bounty
    const bountyFields = [
      'bountyName', 'bountyAvatarUrl', 'defaultThumbnailUrl', 
      'targetUser', 'robloxId', 'bountyAmount', 'bountyReason', 'clipRequired'
    ];
    
    bountyFields.forEach(field => {
      const element = document.getElementById(field);
      if (element) {
        element.addEventListener('input', updateBountyPreview);
        // For select elements use change event
        if (element.tagName === 'SELECT') {
          element.addEventListener('change', updateBountyPreview);
        }
      }
    });
    
    // News Preview Updates
    function updateNewsPreview() {
      const title = document.getElementById('newsTitle').value || 'Announcement Title';
      const content = document.getElementById('newsContent').value || 'News content will appear here...';
      const color = document.getElementById('newsColor').value || '#5865F2';
      const imageUrl = document.getElementById('newsImage').value || '';
      
      document.getElementById('newsTitlePreview').innerText = title;
      document.getElementById('newsContentPreview').innerText = content;
      document.getElementById('news-discord-embed').style.borderLeftColor = color;
      
      if (imageUrl) {
        document.getElementById('newsImagePreviewContainer').style.display = 'block';
        document.getElementById('newsImagePreview').src = imageUrl;
      } else {
        document.getElementById('newsImagePreviewContainer').style.display = 'none';
      }
    }
    
    // Setup news input events
    const newsFields = ['newsTitle', 'newsContent', 'newsColor', 'newsImage'];
    newsFields.forEach(field => {
      const element = document.getElementById(field);
      if (element) {
        element.addEventListener('input', updateNewsPreview);
      }
    });
    
    // Form validation for news
    const newsForm = document.getElementById('newsForm');
    if (newsForm) {
      newsForm.addEventListener('submit', function(e) {
        const title = document.getElementById('newsTitle').value;
        const content = document.getElementById('newsContent').value;
        
        if (!title || !content) {
          e.preventDefault();
          alert('Please provide both a title and content for the news update.');
        }
      });
    }
    
    // Form validation for bounty
    const bountyForm = document.querySelector('#bounty-tab form');
    if (bountyForm) {
      bountyForm.addEventListener('submit', function(e) {
        const targetUser = document.getElementById('targetUser').value;
        const robloxId = document.getElementById('robloxId').value;
        const amount = document.getElementById('bountyAmount').value;
        
        if (!targetUser) {
          e.preventDefault();
          alert('Please provide a target username for the bounty.');
          return;
        }
        
        if (!robloxId) {
          e.preventDefault();
          alert('Please provide a Roblox ID for the target.');
          return;
        }
        
        if (!amount) {
          e.preventDefault();
          alert('Please specify an amount for the bounty.');
          return;
        }
        
        // Validate amount range
        const amountNum = parseInt(amount, 10);
        if (isNaN(amountNum) || amountNum < 15 || amountNum > 30000) {
          e.preventDefault();
          alert('Bounty amount must be between R$15 and R$30,000.');
          return;
        }
      });
    }
    
    // Initialize previews
    updateBountyPreview();
    updateNewsPreview();
  });
</script>