<%- include('../partials/header') %>

<div class="container-fluid admin-dashboard">
  <div class="row">
    <!-- Sidebar -->
    <%- include('./partials/sidebar', { activeNav: 'admin-dashboard' }) %>

    <!-- Main Content -->
    <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
      <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h1 class="h2"><i class="fas fa-tachometer-alt"></i> Admin Dashboard</h1>
        <div class="btn-toolbar mb-2 mb-md-0">
          <div class="btn-group me-2">
            <button type="button" class="btn btn-sm btn-outline-secondary refresh-stats">
              <i class="fas fa-sync-alt"></i> Refresh
            </button>
          </div>
        </div>
      </div>

      <!-- Status Overview Cards -->
      <div class="row">
        <div class="col-md-3 mb-4">
          <div class="card bg-primary text-white h-100">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <h6 class="text-uppercase">Bot Status</h6>
                  <h2 class="mb-0"><%= botStats.status === 'online' ? 'Online' : 'Offline' %></h2>
                </div>
                <i class="fas fa-robot fa-2x"></i>
              </div>
            </div>
            <div class="card-footer d-flex align-items-center justify-content-between">
              <span>Uptime: <%= botStats.uptime %></span>
              <span>Ping: <%= botStats.ping %>ms</span>
            </div>
          </div>
        </div>
        
        <div class="col-md-3 mb-4">
          <div class="card bg-success text-white h-100">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <h6 class="text-uppercase">CPU Usage</h6>
                  <h2 class="mb-0"><%= systemStats.cpuUsage %>%</h2>
                </div>
                <i class="fas fa-microchip fa-2x"></i>
              </div>
            </div>
            <div class="card-footer d-flex align-items-center justify-content-between">
              <span>Platform: <%= systemStats.platform %></span>
              <span>Arch: <%= systemStats.arch %></span>
            </div>
          </div>
        </div>
        
        <div class="col-md-3 mb-4">
          <div class="card bg-warning text-white h-100">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <h6 class="text-uppercase">Memory Usage</h6>
                  <h2 class="mb-0"><%= systemStats.memoryUsage.percentage %>%</h2>
                </div>
                <i class="fas fa-memory fa-2x"></i>
              </div>
            </div>
            <div class="card-footer d-flex align-items-center justify-content-between">
              <span>Used: <%= systemStats.memoryUsage.used %></span>
              <span>Total: <%= systemStats.memoryUsage.total %></span>
            </div>
          </div>
        </div>
        
        <div class="col-md-3 mb-4">
          <div class="card bg-info text-white h-100">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <h6 class="text-uppercase">Servers</h6>
                  <h2 class="mb-0"><%= botStats.guilds %></h2>
                </div>
                <i class="fas fa-server fa-2x"></i>
              </div>
            </div>
            <div class="card-footer d-flex align-items-center justify-content-between">
              <span>Users: <%= botStats.users %></span>
              <span>Channels: <%= botStats.channels %></span>
            </div>
          </div>
        </div>
      </div>

      <!-- Bot Activity & System Health -->
      <div class="row">
        <div class="col-md-8 mb-4">
          <div class="card h-100">
            <div class="card-header">
              <h5 class="mb-0"><i class="fas fa-chart-line"></i> Bot Activity</h5>
            </div>
            <div class="card-body">
              <canvas id="activityChart" height="250"></canvas>
            </div>
          </div>
        </div>
        
        <div class="col-md-4 mb-4">
          <div class="card h-100">
            <div class="card-header">
              <h5 class="mb-0"><i class="fas fa-heartbeat"></i> System Health</h5>
            </div>
            <div class="card-body">
              <div class="d-flex justify-content-between mb-3">
                <span>CPU Usage</span>
                <div class="progress flex-grow-1 mx-3" style="height: 10px;">
                  <div class="progress-bar <%= systemStats.cpuUsage > 80 ? 'bg-danger' : (systemStats.cpuUsage > 60 ? 'bg-warning' : 'bg-success') %>" role="progressbar" style="width: <%= systemStats.cpuUsage %>%" aria-valuenow="<%= systemStats.cpuUsage %>" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <span><%= systemStats.cpuUsage %>%</span>
              </div>
              
              <div class="d-flex justify-content-between mb-3">
                <span>Memory</span>
                <div class="progress flex-grow-1 mx-3" style="height: 10px;">
                  <div class="progress-bar <%= systemStats.memoryUsage.percentage > 80 ? 'bg-danger' : (systemStats.memoryUsage.percentage > 60 ? 'bg-warning' : 'bg-success') %>" role="progressbar" style="width: <%= systemStats.memoryUsage.percentage %>%" aria-valuenow="<%= systemStats.memoryUsage.percentage %>" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <span><%= systemStats.memoryUsage.percentage %>%</span>
              </div>
              
              <div class="d-flex justify-content-between mb-3">
                <span>Uptime</span>
                <span class="ms-auto"><%= systemStats.uptime %></span>
              </div>
              
              <div class="d-flex justify-content-between mb-3">
                <span>Hostname</span>
                <span class="ms-auto"><%= systemStats.hostname %></span>
              </div>
              
              <div class="d-flex justify-content-between">
                <span>Platform</span>
                <span class="ms-auto"><%= systemStats.platform %> (<%= systemStats.arch %>)</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Recent Logs & Quick Actions -->
      <div class="row">
        <div class="col-md-6 mb-4">
          <div class="card h-100">
            <div class="card-header d-flex justify-content-between align-items-center">
              <h5 class="mb-0"><i class="fas fa-list-alt"></i> Recent Logs</h5>
              <a href="/admin/logs" class="btn btn-sm btn-outline-primary">View All</a>
            </div>
            <div class="card-body p-0">
              <div class="list-group list-group-flush">
                <% if (logFiles && logFiles.length > 0) { %>
                  <% logFiles.forEach(file => { %>
                    <a href="/admin/logs/view/<%= file.name %>" class="list-group-item list-group-item-action">
                      <div class="d-flex w-100 justify-content-between">
                        <h6 class="mb-1"><%= file.name %></h6>
                        <small><%= file.size %></small>
                      </div>
                      <p class="mb-1 text-muted">Last modified: <%= file.modified.toLocaleString() %></p>
                    </a>
                  <% }); %>
                <% } else { %>
                  <div class="list-group-item">
                    <p class="mb-0 text-muted">No log files available.</p>
                  </div>
                <% } %>
              </div>
            </div>
          </div>
        </div>
        
        <div class="col-md-6 mb-4">
          <div class="card h-100">
            <div class="card-header">
              <h5 class="mb-0"><i class="fas fa-bolt"></i> Quick Actions</h5>
            </div>
            <div class="card-body">
              <div class="row g-3">
                <div class="col-md-6">
                  <a href="/admin/blacklist" class="btn btn-outline-dark w-100 mb-3">
                    <i class="fas fa-ban"></i> Manage Blacklist
                  </a>
                </div>
                <div class="col-md-6">
                  <a href="/admin/settings" class="btn btn-outline-dark w-100 mb-3">
                    <i class="fas fa-cog"></i> Bot Settings
                  </a>
                </div>
                <div class="col-md-6">
                  <a href="/admin/stats" class="btn btn-outline-dark w-100 mb-3">
                    <i class="fas fa-chart-pie"></i> View Statistics
                  </a>
                </div>
                <div class="col-md-6">
                  <a href="/admin/logs" class="btn btn-outline-dark w-100 mb-3">
                    <i class="fas fa-clipboard-list"></i> View Logs
                  </a>
                </div>
              </div>
              
              <div class="mt-3 pt-3 border-top">
                <h6>Bot Commands</h6>
                <div class="row g-2">
                  <div class="col-md-6">
                    <button class="btn btn-sm btn-success w-100" id="restartBot">
                      <i class="fas fa-sync"></i> Restart Bot
                    </button>
                  </div>
                  <div class="col-md-6">
                    <button class="btn btn-sm btn-danger w-100" id="stopBot">
                      <i class="fas fa-stop-circle"></i> Stop Bot
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // Sample chart data - would be replaced with real data
  window.addEventListener('DOMContentLoaded', () => {
    const ctx = document.getElementById('activityChart').getContext('2d');
    
    const activityChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: ['24h ago', '20h ago', '16h ago', '12h ago', '8h ago', '4h ago', 'Now'],
        datasets: [
          {
            label: 'Commands',
            data: [65, 59, 80, 81, 56, 55, 72],
            borderColor: 'rgb(75, 192, 192)',
            tension: 0.1,
            fill: false
          },
          {
            label: 'Users',
            data: [28, 48, 40, 19, 86, 27, 90],
            borderColor: 'rgb(255, 99, 132)',
            tension: 0.1,
            fill: false
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false
      }
    });
    
    // Refresh stats button
    document.querySelector('.refresh-stats').addEventListener('click', function() {
      location.reload();
    });
    
    // Bot control buttons
    document.getElementById('restartBot').addEventListener('click', function() {
      if (confirm('Are you sure you want to restart the bot?')) {
        fetch('/api/bot/restart', { method: 'POST' })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              alert('Bot is restarting...');
            } else {
              alert('Failed to restart bot: ' + data.message);
            }
          })
          .catch(error => {
            console.error('Error:', error);
            alert('An error occurred while trying to restart the bot.');
          });
      }
    });
    
    document.getElementById('stopBot').addEventListener('click', function() {
      if (confirm('Are you sure you want to stop the bot?')) {
        fetch('/api/bot/stop', { method: 'POST' })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              alert('Bot is stopping...');
            } else {
              alert('Failed to stop bot: ' + data.message);
            }
          })
          .catch(error => {
            console.error('Error:', error);
            alert('An error occurred while trying to stop the bot.');
          });
      }
    });
  });
</script>

<%- include('../partials/footer') %>
